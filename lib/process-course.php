<?php include("config.php");include("common.php");include("aes.php");	if(isset($_POST) and $_SERVER['REQUEST_METHOD'] == "POST"){ $json     = array();$_a        = isset( $_POST['_a'] ) ? escape_s($_POST['_a']) : '';$_title   = isset( $_POST['c_title'] ) ? escape_s($_POST['c_title']) : '';$_code    = isset( $_POST['c_code'] ) ? escape_s($_POST['c_code']) : '';$_duration = isset( $_POST['c_duration'] ) ? escape_s($_POST['c_duration']) : '';    $c_jb   = isset( $_POST['c_jb'] ) ? escape_s($_POST['c_jb']) : '';$c_pc   = isset( $_POST['c_pc'] ) ? escape_s($_POST['c_pc']) : '';$_summary = isset( $_POST['c_summary'] ) ? escape_s($_POST['c_summary']) : '';$visibility = isset( $_POST['visibility'] ) ? escape_s($_POST['visibility']) : '';$_category = '';if( !$_title ) {    $json['error']['title'] = 'title is required';}else{    if(strlen($_title)  < 5 ) {    $json['error']['title'] = 'Please your title is too short';}}if( !$visibility ) {    $json['error']['visibility'] = 'course visibility is required';}else{    if($visibility == '2' && empty($c_jb)  ) {        $json['error']['c_jb'] = 'Please your job family is required';        $_category   = $c_jb ;     }    if($visibility == '3' && empty($c_pc)  ) {        $json['error']['c_pc'] = 'Please your professional categories is required';        $_category   = $c_pc ;      }}if( $visibility == '1' ) {        $_category   = '99999' ;  }if( $visibility == '2' ) {        $_category   = $c_jb ;  }if( $visibility == '3' ) {        $_category   = $c_pc ;  }// $_category   = ( $visibility == 2 ) ? $c_jb :  $c_pc;// if(empty($_category)) {//     $json['error']['category'] = 'course category is required';// }if( !$_duration) {    $json['error']['duration'] = 'your course duration is empty';}if( !$_code) {    $json['error']['code'] = 'your course description is empty';  }else{    if( strlen($_code)  < 20 ) {        $json['error']['code'] = 'your course description is too short, please write more';    }  }if( !$_summary) {    $json['error']['summary'] = 'Course summary or intro is is empty';}else{    if( strlen($_summary)  < 5 ) {        $json['error']['summary'] = 'Course summary is too short, please write more';    }  }//print_r($_FILES);//die();              //if they DID upload a file...    if($_FILES['c_picture']['name']){        $file_thumb = $_FILES['c_picture'];         list($otherpartt, $extension) = explode(".", strtolower($_FILES["c_picture"]["name"]));        //$extension = end();        $currentdir = '';            // check if picture size is more than allowed in config          if($_FILES['c_picture']['size'] > ($max_upload_size)) //can't be larger than 1 MB          {              $json['error']['upload']= 'Oops!  Your file\'s size is to large.';          }            // check if picture type is within allowed Extensions          if (!in_array( $extension,  $allowedExtensions))           {                 $json['error']['upload'] = ' is an invalid file type!';          }          // if folder doesnt exit, create it        if(!is_dir($currentdir . $thumb_folder)){           // create the directory            if (!mkdir($currentdir . $thumb_folder, 0777, true)) {               $json['error']['upload'] = 'Unable to Create Upload directory';            }        }      }if( !isset( $json['error'] ) ) {// echo $_category;switch ($_a) {    case 'new':        $i = genRand();              if($_FILES['c_picture']['name']){                $file_thumb = $_FILES['c_picture'];                 list($otherpartt, $extension) = explode(".", strtolower($_FILES["c_picture"]["name"]));                $currentdir = '';                $target =  $thumb_folder . $i.'.'.$extension;                    // check if picture thumbnail already exist               if($_FILES['c_picture']['name'])                  {                          move_uploaded_file($_FILES['c_picture']['tmp_name'], $target);                 }              }        if(query("INSERT INTO $tbl_course(id,title,duration,summary,description,date,category,status,visibility)        VALUES('$i','$_title','$_duration','$_summary','$_code',NOW(),'$_category','0','$visibility')")){                $json['success'] = 'Course has been added!';                 $json['goto'] =  $i;       }else{            $json['error']['course'] = 'Server error, please check back later';        }        break;         case 'edit':        $_c  = isset( $_POST['_c'] ) ? escape_s($_POST['_c']) : '';              if($_FILES['c_picture']['name']){                $file_thumb = $_FILES['c_picture'];                 list($otherpartt, $extension) = explode(".", strtolower($_FILES["c_picture"]["name"]));                $currentdir = '';                $target =  $thumb_folder . $_c.'.'.$extension;                    // check if picture thumbnail already exist               if($_FILES['c_picture']['name'])                  {                          move_uploaded_file($_FILES['c_picture']['tmp_name'], $target);                 }              }        if(query("UPDATE $tbl_course SET title='$_title', category='$_category', duration='$_duration', summary='$_summary', description='$_code', visibility='$visibility', category='$_category' WHERE id='$_c'")){                $json['success'] = 'Course Updated!';        }else{            $json['error']['course'] = 'Server error, please check back later';        }                break;  default:        # code...        break;}}echo json_encode( $json );}?>